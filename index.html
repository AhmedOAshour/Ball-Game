<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <script src="lib/three.js"></script>
    <script src="lib/OrbitControls.js"></script>
    <script src="lib/GLTFLoader.js"></script>
    <script>
    var scene = new THREE.Scene();
    //(field of view in degrees, , near clipping plane, far clipping plane)
    var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    var renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight)
    document.body.appendChild(renderer.domElement);

    controls = new THREE.OrbitControls(camera,renderer.domElement);
    controls.maxDistance = 50;
    controls.minDistance = 50;
    controls.maxPolarAngle = Math.PI/3;
    controls.minPolarAngle = Math.PI/3;
    controls.rotateSpeed = 5;
    controls.enabled = false;
    //camera.rotation.y = Math.PI;
    camera.position.y = 50;
    camera.position.x = -40;

var mesh;
var player;
const acc=0.1;
const turnrate=0.05;
const maxSpeed=1;
var speed = 0;
//65 left 68 right 87 up 83 down
var array = {65: false, 68: false, 87: false, 83: false, 119:false, 115:false, 100:false, 97:false};    //event listener for resizing app to window size
    window.addEventListener('resize', function()
    {
      var width = window.innerWidth;
      var height = window.innerHeight;
      renderer.setSize(width, height);
      camera.aspect = width / height;
      camera.updateProjectionMatrix();
    });

    loader = new THREE.GLTFLoader();

    // Load a glTF resource
    loader.load(
    	// resource URL
    	'models/moon/scene.gltf',
    	// called when the resource is loaded
      function ( gltf ) {

          player = gltf.scene;
          player.scale.set(0.1,0.1,0.1);
          controls.target.set(player.position.x,player.position.y,player.position.z);
          controls.update();

          //camera.lookAt(player.position);
          scene.add( player );
      },
    	// called while loading is progressing
    	function ( xhr ) {
    		console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );
    	},
    	// called when loading has errors
    	function ( error ) {
    		console.log( 'An error happened' );
    	}
    );

    var ambientLight = new THREE.AmbientLight(0xefebd8, 2);
    scene.add(ambientLight)

    cubeGeometry = new THREE.CubeGeometry(300, 0, 300);
      cubeMaterial = new THREE.MeshBasicMaterial( {color:'rgb(0,0,250)'} );
      cube = new THREE.Mesh( cubeGeometry, cubeMaterial );
      cube.translateY(-10);
     scene.add(cube);

     {
    const loader = new THREE.CubeTextureLoader();
    const texture = loader.load([
      'models/skybox/front.png',
      'models/skybox/back.png',
      'models/skybox/up.png',
      'models/skybox/down.png',
      'models/skybox/left.png',
      'models/skybox/right.png',

    ]);
    scene.background = texture;
  }

var render = function()
{
  renderer.render(scene, camera);
};

window.addEventListener ("keypress",event=>{
  if(event.keyCode in array)
      array[event.keyCode] = true;
});

window.addEventListener ("keyup",event=>{
  if(event.keyCode in array)
    array[event.keyCode] = false;
});

var accelerate = function(x){
  if(speed>=maxSpeed || speed<=-maxSpeed){
    return;
  }
  if(x==1)
  {
    speed+=acc;
  }
  else
  {
    speed-=acc;
  }
}
// small letters dont stop
var playerMovement = function(){
  //65 left 68 right 87 up 83 down
  if(array[87]){
        //Forward
        accelerate(1);
    }
  if(array[83]){
        //Back
        accelerate(2);
    }
  if(array[65]){
        //left
        player.rotateY(turnrate);

    }
  if(array[68]){
        //right
        player.rotateY(-turnrate);
    }
  player.translateX(speed);
  controls.target.set(player.position.x,player.position.y,player.position.z);
  //camera.position.x = player.position.x-40
  controls.update();
  //camera.lookAt(player.position);
}

var GameLoop = function()
{

  if(player)
    {

      playerMovement();



      if(speed>0)
        {
          speed-=0.01;
        }
        else if(speed<0)
        {
          speed+=0.01;
        }

    }

  requestAnimationFrame(GameLoop);

  render();
}
  GameLoop();
    </script>
  </body>
</html>
